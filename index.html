<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Découvrez l'archétype de votre enfant</title>
  <style>
    body{font-family:sans-serif;background:#f5f5f5;padding:20px}
    .form-step{display:none;background:#fff;padding:20px;margin-bottom:10px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
    .form-step.active{display:block}
    .btn{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin:5px}
    .btn-primary{background:#0055A4;color:#fff}
    .btn-secondary{background:#ccc;color:#333}
    .error{color:#D9534F;font-size:0.9em;display:none;margin-top:5px}
    .card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin-bottom:10px}
    .selection-card{border:1px solid #ddd;border-radius:5px;padding:10px;text-align:center;cursor:pointer}
    .selection-card.selected{border-color:#0055A4;background:rgba(0,85,164,0.1)}
    .faq-item{margin-bottom:10px}
    .faq-question{background:#eee;padding:10px;cursor:pointer;border-radius:5px}
    .faq-answer{display:none;padding:10px;border-left:3px solid #0055A4;background:#fff}
    .faq-item.active .faq-answer{display:block}
  </style>
</head>
<body>
  <h1>Découvrez l'archétype de votre enfant</h1>
  <div id="progress" style="margin-bottom:20px">
    <div style="background:#ddd;height:10px;border-radius:5px;overflow:hidden">
      <div id="progress-bar" style="height:10px;width:0%;background:#0055A4"></div>
    </div>
    <div id="progress-info" style="text-align:right;font-weight:bold">0%</div>
  </div>
  <form id="archetype-form">
    <!-- Étape 1 -->
    <div class="form-step active" data-step="1">
      <p>Bienvenue ! Prêt à découvrir l'archétype de votre enfant ?</p>
      <button type="button" class="btn btn-primary" id="next-1">Commencer</button>
    </div>
    <!-- Étape 2 -->
    <div class="form-step" data-step="2">
      <label>Prénom de l'enfant:<br>
        <input type="text" id="child-name" name="child-name" required>
      </label>
      <div class="error" id="child-name-error">Requis</div>
      <label>Niveau scolaire:<br>
        <select id="child-school-level" name="child-school-level" required>
          <option value="">--</option>
          <option value="primaire-cp">CP</option>
          <option value="primaire-ce1">CE1</option>
          <!-- Ajoute les autres options -->
        </select>
      </label>
      <div class="error" id="child-school-level-error">Requis</div>
      <button type="button" class="btn btn-secondary prev-btn">Précédent</button>
      <button type="button" class="btn btn-primary" id="next-2">Suivant</button>
    </div>
    <!-- Étape 3 -->
    <div class="form-step" data-step="3">
      <p>Sélectionnez jusqu'à 4 qualités :</p>
      <div class="card-grid" id="strengths-grid">
        <div class="selection-card" data-value="Curieux">Curieux</div>
        <div class="selection-card" data-value="Créatif">Créatif</div>
        <div class="selection-card" data-value="Organisé">Organisé</div>
        <div class="selection-card" data-value="Persévérant">Persévérant</div>
      </div>
      <input type="hidden" id="strengths" name="strengths" required>
      <div class="error" id="strengths-error">Sélectionnez au moins 1 qualité</div>
      <button type="button" class="btn btn-secondary prev-btn">Précédent</button>
      <button type="button" class="btn btn-primary" id="next-3">Suivant</button>
    </div>
    <!-- Étape 4 -->
    <div class="form-step" data-step="4">
      <p>Sélectionnez votre style d'apprentissage :</p>
      <div class="card-grid" id="learning-style-grid">
        <div class="selection-card" data-value="Visuel">Visuel</div>
        <div class="selection-card" data-value="Auditif">Auditif</div>
        <div class="selection-card" data-value="Kinesthésique">Kinesthésique</div>
      </div>
      <input type="hidden" id="learning-style" name="learning-style" required>
      <div class="error" id="learning-style-error">Sélectionnez un style</div>
      <button type="button" class="btn btn-secondary prev-btn">Précédent</button>
      <button type="button" class="btn btn-primary" id="next-4">Suivant</button>
    </div>
    <!-- Étape 5 -->
    <div class="form-step" data-step="5">
      <p>Budget et localisation :</p>
      <label>Budget:<br>
        <select id="budget" name="budget" required>
          <option value="">--</option>
          <option value="100-200">100-200€</option>
        </select>
      </label>
      <div class="error" id="budget-error">Requis</div>
      <label>Zone géographique:<br>
        <input type="text" id="location" name="location" required>
      </label>
      <div class="error" id="location-error">Requis</div>
      <button type="button" class="btn btn-secondary prev-btn">Précédent</button>
      <button type="button" class="btn btn-primary" id="next-5">Suivant</button>
    </div>
    <!-- Étape 6 -->
    <div class="form-step" data-step="6">
      <p>Vos coordonnées :</p>
      <label>Email:<br>
        <input type="email" id="parent-email" name="parent-email" required>
      </label>
      <div class="error" id="parent-email-error">Invalide</div>
      <label>
        <input type="checkbox" id="rgpd-consent" name="rgpd-consent" required>
        J'accepte...
      </label>
      <div class="error" id="rgpd-consent-error">Requis</div>
      <button type="button" class="btn btn-secondary prev-btn">Précédent</button>
      <button type="submit" class="btn btn-primary">Envoyer</button>
    </div>
  </form>

  <h2>FAQ</h2>
  <div class="faq-item">
    <div class="faq-question">Comment ça marche ?</div>
    <div class="faq-answer">Explication...</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const steps = [...document.querySelectorAll('.form-step')];
      let current = 0;
      const progressBar = document.getElementById('progress-bar');
      const progressInfo = document.getElementById('progress-info');
      const form = document.getElementById('archetype-form');
      const webhook = 'https://hooks.airtable.com/workflows/v1/genericWebhook/appJ34INj8TdrYu22/wflCnHSeM0hhnMRFJ/wtr3EvRbAwKPJnegg';

      function updateWizard() {
        steps.forEach((s, i) => s.classList.toggle('active', i === current));
        const pct = (current / (steps.length - 1)) * 100;
        progressBar.style.width = pct + '%';
        progressInfo.textContent = Math.round(pct) + '%';
        window.scrollTo(0, 0);
      }

      function validate(stepIdx) {
        let ok = true;
        const step = steps[stepIdx];
        step.querySelectorAll('[required]').forEach(el => {
          const errorEl = document.getElementById(el.id + '-error');
          if ((el.type === 'checkbox' && !el.checked) || (el.type !== 'checkbox' && !el.value.trim())) {
            if (errorEl) errorEl.style.display = 'block';
            ok = false;
          } else {
            if (errorEl) errorEl.style.display = 'none';
          }
        });
        return ok;
      }

      document.querySelectorAll('button[id^="next-"]').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = current + 1;
          if (current === 0 || validate(idx)) {
            current = Math.min(idx, steps.length - 1);
            updateWizard();
          }
        });
      });

      document.querySelectorAll('.prev-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          current = Math.max(current - 1, 0);
          updateWizard();
        });
      });

      document.getElementById('archetype-form').addEventListener('submit', e => {
        e.preventDefault();
        if (!validate(steps.length - 1)) return;
        const data = {};
        new FormData(form).forEach((v, k) => data[k] = v);
        fetch(webhook, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        }).then(() => alert('Envoyé !')).catch(() => alert('Erreur'));
      });

      document.querySelectorAll('.faq-question').forEach(q => {
        q.addEventListener('click', () => q.parentElement.classList.toggle('active'));
      });

      updateWizard();
    });
  </script>
</body>
</html>
